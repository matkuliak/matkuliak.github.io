<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="742px" preserveAspectRatio="none" style="width:1047px;height:742px;background:#FFFFFF;" version="1.1" viewBox="0 0 1047 742" width="1047px" zoomAndPan="magnify"><defs><filter height="300%" id="f1wn17312pkqls" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="228" x="407.5" y="28.708">Closing transaction (RPC)</text><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="515.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="256" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="470.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="412.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="515.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="577.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="322.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="716.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="293.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="830.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="368.8594" style="stroke:#000000;stroke-width:2.0;" width="850" x="183" y="242.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="48" x2="48" y1="123.25" y2="657.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="261" x2="261" y1="123.25" y2="657.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="417" x2="417" y1="123.25" y2="657.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="582" x2="582" y1="123.25" y2="657.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="721" x2="721" y1="123.25" y2="657.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="835" x2="835" y1="123.25" y2="657.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="973" x2="973" y1="123.25" y2="657.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="5" y="119.9482">Application</text><ellipse cx="48" cy="49.9531" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M48,57.9531 L48,84.9531 M35,65.9531 L61,65.9531 M48,84.9531 L35,99.9531 M48,84.9531 L61,99.9531 " fill="none" filter="url(#f1wn17312pkqls)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="5" y="669.7686">Application</text><ellipse cx="48" cy="683.0703" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M48,691.0703 L48,718.0703 M35,699.0703 L61,699.0703 M48,718.0703 L35,733.0703 M48,718.0703 L61,733.0703 " fill="none" filter="url(#f1wn17312pkqls)" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="193" y="119.9482">UniconfigManager</text><path d="M240.5,78.9531 L240.5,102.9531 M240.5,90.9531 L257.5,90.9531 " fill="none" filter="url(#f1wn17312pkqls)" style="stroke:#A80036;stroke-width:2.0;"/><ellipse cx="269.5" cy="90.9531" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="130" x="193" y="669.7686">UniconfigManager</text><path d="M240.5,677.0703 L240.5,701.0703 M240.5,689.0703 L257.5,689.0703 " fill="none" filter="url(#f1wn17312pkqls)" style="stroke:#A80036;stroke-width:2.0;"/><ellipse cx="269.5" cy="689.0703" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="339" y="119.9482">UniconfigTransaction</text><ellipse cx="417.5" cy="90.9531" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="405.5" x2="429.5" y1="104.9531" y2="104.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="339" y="669.7686">UniconfigTransaction</text><ellipse cx="417.5" cy="689.0703" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><line style="stroke:#A80036;stroke-width:2.0;" x1="405.5" x2="429.5" y1="703.0703" y2="703.0703"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="506" y="119.9482">TransactionManager</text><ellipse cx="582.5" cy="90.9531" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="578.5,78.9531,584.5,73.9531,582.5,78.9531,584.5,83.9531,578.5,78.9531" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="147" x="506" y="669.7686">TransactionManager</text><ellipse cx="582.5" cy="689.0703" fill="#FEFECE" filter="url(#f1wn17312pkqls)" rx="12" ry="12" style="stroke:#A80036;stroke-width:2.0;"/><polygon fill="#A80036" points="578.5,677.0703,584.5,672.0703,582.5,677.0703,584.5,682.0703,578.5,677.0703" style="stroke:#A80036;stroke-width:1.0;"/><rect fill="#FEFECE" filter="url(#f1wn17312pkqls)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="101" x="669" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="676" y="107.9482">DatastoreTx</text><rect fill="#FEFECE" filter="url(#f1wn17312pkqls)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="101" x="669" y="656.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="676" y="676.7686">DatastoreTx</text><rect fill="#FEFECE" filter="url(#f1wn17312pkqls)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="99" x="784" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="791" y="107.9482">DatabaseTx</text><rect fill="#FEFECE" filter="url(#f1wn17312pkqls)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="99" x="784" y="656.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="791" y="676.7686">DatabaseTx</text><rect fill="#FEFECE" filter="url(#f1wn17312pkqls)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="95" x="924" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="931" y="107.9482">PostgreSQL</text><rect fill="#FEFECE" filter="url(#f1wn17312pkqls)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="95" x="924" y="656.7734"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="931" y="676.7686">PostgreSQL</text><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="515.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="256" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="470.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="412.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="515.5234" style="stroke:#A80036;stroke-width:1.0;" width="10" x="577.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="322.5938" style="stroke:#A80036;stroke-width:1.0;" width="10" x="716.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="293.4609" style="stroke:#A80036;stroke-width:1.0;" width="10" x="830.5" y="133.25"/><polygon fill="#A80036" points="244,165.5156,254,169.5156,244,173.5156,248,169.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="48" x2="250" y1="169.5156" y2="169.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="55" y="149.3169">close transaction RPC</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="59" y="164.4497">(cookie with transaction ID)</text><polygon fill="#A80036" points="565.5,194.6484,575.5,198.6484,565.5,202.6484,569.5,198.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="266" x2="571.5" y1="198.6484" y2="198.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="273" y="193.5825">get transaction (transaction ID)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="266" x2="276" y1="227.7813" y2="223.7813"/><line style="stroke:#A80036;stroke-width:1.0;" x1="266" x2="276" y1="227.7813" y2="231.7813"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266" x2="576.5" y1="227.7813" y2="227.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="283" y="222.7153">uniconfig transaction</text><path d="M183,242.7813 L252,242.7813 L252,249.7813 L242,259.7813 L183,259.7813 L183,242.7813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="368.8594" style="stroke:#000000;stroke-width:2.0;" width="850" x="183" y="242.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="198" y="255.8481">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="141" x="267" y="254.9917">["transaction is alive"]</text><polygon fill="#A80036" points="400.5,277.0469,410.5,281.0469,400.5,285.0469,404.5,281.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="266" x2="406.5" y1="281.0469" y2="281.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="273" y="275.981">close transaction</text><polygon fill="#A80036" points="704.5,306.1797,714.5,310.1797,704.5,314.1797,708.5,310.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="710.5" y1="310.1797" y2="310.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="42" x="429.5" y="305.1138">cancel</text><polygon fill="#A80036" points="818.5,335.3125,828.5,339.3125,818.5,343.3125,822.5,339.3125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="726.5" x2="824.5" y1="339.3125" y2="339.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="733.5" y="334.2466">close</text><polygon fill="#A80036" points="961.5,364.4453,971.5,368.4453,961.5,372.4453,965.5,368.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="840.5" x2="967.5" y1="368.4453" y2="368.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="847.5" y="363.3794">close connection</text><line style="stroke:#A80036;stroke-width:1.0;" x1="840.5" x2="850.5" y1="397.5781" y2="393.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="840.5" x2="850.5" y1="397.5781" y2="401.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="840.5" x2="972.5" y1="397.5781" y2="397.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="857.5" y="392.5122">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="726.5" x2="736.5" y1="426.7109" y2="422.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="726.5" x2="736.5" y1="426.7109" y2="430.7109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="726.5" x2="834.5" y1="426.7109" y2="426.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="743.5" y="421.645">ack</text><line style="stroke:#A80036;stroke-width:2.0;" x1="826.5" x2="844.5" y1="417.7109" y2="435.7109"/><line style="stroke:#A80036;stroke-width:2.0;" x1="826.5" x2="844.5" y1="435.7109" y2="417.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="432.5" y1="455.8438" y2="451.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="432.5" y1="455.8438" y2="459.8438"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="422.5" x2="720.5" y1="455.8438" y2="455.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="439.5" y="450.7778">ack</text><line style="stroke:#A80036;stroke-width:2.0;" x1="712.5" x2="730.5" y1="446.8438" y2="464.8438"/><line style="stroke:#A80036;stroke-width:2.0;" x1="712.5" x2="730.5" y1="464.8438" y2="446.8438"/><polygon fill="#A80036" points="565.5,496.1094,575.5,500.1094,565.5,504.1094,569.5,500.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="571.5" y1="500.1094" y2="500.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="125" x="429.5" y="479.9106">release transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101" x="433.5" y="495.0435">(transaction ID)</text><rect fill="#FFFFFF" filter="url(#f1wn17312pkqls)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="196" x="503" y="508.1094"/><path d="M503,508.1094 L569,508.1094 L569,515.1094 L559,525.1094 L503,525.1094 L503,508.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="516" y="522.1763">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="509" y="541.1763">Clean orphaned mountpoints</text><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="432.5" y1="574.5078" y2="570.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="422.5" x2="432.5" y1="574.5078" y2="578.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="422.5" x2="576.5" y1="574.5078" y2="574.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="439.5" y="569.4419">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="266" x2="276" y1="603.6406" y2="599.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="266" x2="276" y1="603.6406" y2="607.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266" x2="416.5" y1="603.6406" y2="603.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="283" y="598.5747">ack</text><line style="stroke:#A80036;stroke-width:2.0;" x1="408.5" x2="426.5" y1="594.6406" y2="612.6406"/><line style="stroke:#A80036;stroke-width:2.0;" x1="408.5" x2="426.5" y1="612.6406" y2="594.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="48" x2="58" y1="639.7734" y2="635.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="48" x2="58" y1="639.7734" y2="643.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="48" x2="255" y1="639.7734" y2="639.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="65" y="634.7075">response</text><!--MD5=[c83b9bfc7258570fb576487154e85651]
@startuml
title "Closing transaction (RPC)"

actor Application
boundary UniconfigManager
entity UniconfigTransaction
control TransactionManager

activate UniconfigManager
activate UniconfigTransaction
activate TransactionManager
activate DatastoreTx
activate DatabaseTx

Application -> UniconfigManager: close transaction RPC\n (cookie with transaction ID)
UniconfigManager -> TransactionManager: get transaction (transaction ID)
TransactionManager - ->> UniconfigManager: uniconfig transaction

opt "transaction is alive"
    UniconfigManager -> UniconfigTransaction: close transaction
    UniconfigTransaction -> DatastoreTx: cancel
    DatastoreTx -> DatabaseTx: close
    DatabaseTx -> PostgreSQL: close connection
    PostgreSQL - ->> DatabaseTx: ack
    DatabaseTx - ->> DatastoreTx: ack
    destroy DatabaseTx
    DatastoreTx - ->> UniconfigTransaction: ack
    destroy DatastoreTx

    UniconfigTransaction -> TransactionManager: release transaction\n (transaction ID)
    ref over TransactionManager
        Clean orphaned mountpoints
    end
    TransactionManager - ->> UniconfigTransaction: ack
    UniconfigTransaction - ->> UniconfigManager: ack
    destroy UniconfigTransaction
end

UniconfigManager - ->> Application: response
@enduml

PlantUML version 1.2021.11(Sat Oct 02 15:26:11 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>