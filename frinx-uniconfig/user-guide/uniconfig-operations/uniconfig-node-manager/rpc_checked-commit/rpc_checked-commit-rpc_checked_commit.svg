<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="639px" preserveAspectRatio="none" style="width:1106px;height:639px;background:#FFFFFF;" version="1.1" viewBox="0 0 1106 639" width="1106px" zoomAndPan="magnify"><defs><filter height="300%" id="f1h5n8rv6mbla5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="193" x="454.5" y="28.708">RPC checked-commit</text><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="490.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="322" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="490.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="766" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="728.5" x="224.5" y="214.6484"/><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="136.7969" style="stroke:#000000;stroke-width:2.0;" width="1082" x="10" y="404.4453"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="123.25" y2="632.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="326.5" x2="326.5" y1="123.25" y2="632.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="771" x2="771" y1="123.25" y2="632.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="887" x2="887" y1="123.25" y2="632.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1017" x2="1017" y1="123.25" y2="632.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="20" y="119.9482">Application</text><ellipse cx="63" cy="49.9531" fill="#FEFECE" filter="url(#f1h5n8rv6mbla5)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M63,57.9531 L63,84.9531 M50,65.9531 L76,65.9531 M63,84.9531 L50,99.9531 M63,84.9531 L76,99.9531 " fill="none" filter="url(#f1h5n8rv6mbla5)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1h5n8rv6mbla5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="234.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="241.5" y="107.9482">UniconfigNodeManager</text><rect fill="#FEFECE" filter="url(#f1h5n8rv6mbla5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="724" y="83.9531"/><rect fill="#FEFECE" filter="url(#f1h5n8rv6mbla5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="720" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="727" y="107.9482">Mountpoint</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="832" y="119.9482">OperDatastore</text><path d="M869.5,70.9531 C869.5,60.9531 887.5,60.9531 887.5,60.9531 C887.5,60.9531 905.5,60.9531 905.5,70.9531 L905.5,96.9531 C905.5,106.9531 887.5,106.9531 887.5,106.9531 C887.5,106.9531 869.5,106.9531 869.5,96.9531 L869.5,70.9531 " fill="#FEFECE" filter="url(#f1h5n8rv6mbla5)" style="stroke:#000000;stroke-width:1.5;"/><path d="M869.5,70.9531 C869.5,80.9531 887.5,80.9531 887.5,80.9531 C887.5,80.9531 905.5,80.9531 905.5,70.9531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1h5n8rv6mbla5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="957" y="83.9531"/><rect fill="#FEFECE" filter="url(#f1h5n8rv6mbla5)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="953" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="960" y="107.9482">NetworkDevice</text><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="490.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="322" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="490.3906" style="stroke:#A80036;stroke-width:1.0;" width="10" x="766" y="133.25"/><polygon fill="#A80036" points="310,150.3828,320,154.3828,310,158.3828,314,154.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="316" y1="154.3828" y2="154.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="70" y="149.3169">RPC checked-commit (target nodes)</text><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="849.5" x="231.5" y="162.3828"/><path d="M231.5,162.3828 L297.5,162.3828 L297.5,169.3828 L287.5,179.3828 L231.5,179.3828 L231.5,162.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="244.5" y="176.4497">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="605.25" y="195.4497">previous phases</text><path d="M224.5,214.6484 L300.5,214.6484 L300.5,221.6484 L290.5,231.6484 L224.5,231.6484 L224.5,214.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="175.7969" style="stroke:#000000;stroke-width:2.0;" width="728.5" x="224.5" y="214.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="239.5" y="227.7153">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="315.5" y="226.8589">[for each target node]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="764" x2="754" y1="252.9141" y2="248.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="764" x2="754" y1="252.9141" y2="256.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="332" x2="765" y1="252.9141" y2="252.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="339" y="247.8481">read (config-metadata node IID)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="332" x2="342" y1="282.0469" y2="278.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="332" x2="342" y1="282.0469" y2="286.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="332" x2="765" y1="282.0469" y2="282.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="349" y="276.981">config-metadata (includes device fingerprint)</text><polygon fill="#A80036" points="875.5,307.1797,885.5,311.1797,875.5,315.1797,879.5,311.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="332" x2="881.5" y1="311.1797" y2="311.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="339" y="306.1138">read (config-metadata node IID)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="332" x2="342" y1="340.3125" y2="336.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="332" x2="342" y1="340.3125" y2="344.3125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="332" x2="886.5" y1="340.3125" y2="340.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="349" y="335.2466">config-metadata (includes device fingerprint)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="332" x2="374" y1="369.4453" y2="369.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="374" x2="374" y1="369.4453" y2="382.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="333" x2="374" y1="382.4453" y2="382.4453"/><polygon fill="#A80036" points="343,378.4453,333,382.4453,343,386.4453,339,382.4453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="420" x="339" y="364.3794">compare fingerprint from unified mountpoint and uniconfig node</text><path d="M10,404.4453 L79,404.4453 L79,411.4453 L69,421.4453 L10,421.4453 L10,404.4453 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="136.7969" style="stroke:#000000;stroke-width:2.0;" width="1082" x="10" y="404.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="25" y="417.5122">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="414" x="94" y="416.6558">[comparison of fingerprints between devices and datastore failed]</text><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="849.5" x="231.5" y="421.5781"/><path d="M231.5,421.5781 L297.5,421.5781 L297.5,428.5781 L287.5,438.5781 L231.5,438.5781 L231.5,421.5781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="244.5" y="435.645">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="601.25" y="454.645">Rollback changes</text><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="187" x="231.5" y="466.8438"/><path d="M231.5,466.8438 L297.5,466.8438 L297.5,473.8438 L287.5,483.8438 L231.5,483.8438 L231.5,466.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="244.5" y="480.9106">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="270.5" y="499.9106">Close transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="533.2422" y2="529.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="533.2422" y2="537.2422"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="321" y1="533.2422" y2="533.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="80" y="528.1763">RPC response with error</text><rect fill="#FFFFFF" filter="url(#f1h5n8rv6mbla5)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="849.5" x="231.5" y="548.2422"/><path d="M231.5,548.2422 L297.5,548.2422 L297.5,555.2422 L287.5,565.2422 L231.5,565.2422 L231.5,548.2422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="244.5" y="562.3091">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="618.75" y="581.3091">next phases</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="614.6406" y2="610.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="614.6406" y2="618.6406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="321" y1="614.6406" y2="614.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="80" y="609.5747">RPC response</text><!--MD5=[bfb3da1e250a061e1197375363dd8ce8]
@startuml
hide footbox
title "RPC checked-commit"

actor Application
participant UniconfigNodeManager
collections Mountpoint
database OperDatastore
collections NetworkDevice

activate UniconfigNodeManager
activate Mountpoint

Application -> UniconfigNodeManager: RPC checked-commit (target nodes)
ref over UniconfigNodeManager, NetworkDevice: previous phases

loop for each target node
    UniconfigNodeManager ->> Mountpoint: read (config-metadata node IID)
    Mountpoint - ->> UniconfigNodeManager: config-metadata (includes device fingerprint)
    UniconfigNodeManager -> OperDatastore: read (config-metadata node IID)
    OperDatastore - ->> UniconfigNodeManager: config-metadata (includes device fingerprint)
    UniconfigNodeManager -> UniconfigNodeManager: compare fingerprint from unified mountpoint and uniconfig node
end

opt comparison of fingerprints between devices and datastore failed
    ref over UniconfigNodeManager, NetworkDevice: Rollback changes
    ref over UniconfigNodeManager: Close transaction
    UniconfigNodeManager - ->> Application: RPC response with error
end

ref over UniconfigNodeManager, NetworkDevice: next phases
Application <<- - UniconfigNodeManager: RPC response
@enduml

PlantUML version 1.2021.11(Sat Oct 02 15:26:11 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>