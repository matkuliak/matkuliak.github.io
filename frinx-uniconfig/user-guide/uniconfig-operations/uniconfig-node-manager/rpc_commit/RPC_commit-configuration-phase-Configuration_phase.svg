<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="890px" preserveAspectRatio="none" style="width:1225px;height:890px;background:#FFFFFF;" version="1.1" viewBox="0 0 1225 890" width="1225px" zoomAndPan="magnify"><defs><filter height="300%" id="f1453dndg8t41j" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="179" x="521.25" y="28.708">Configuration phase</text><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="741.6172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="263" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="741.6172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="443.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="741.6172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="582.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="424.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="719" y="450.7109"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="427.0234" style="stroke:#000000;stroke-width:2.0;" width="1056" x="155.5" y="214.6484"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="1036" x="165.5" y="501.0078"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="136.7969" style="stroke:#000000;stroke-width:2.0;" width="1191.5" x="10" y="655.6719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="123.25" y2="883.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="267.5" x2="267.5" y1="123.25" y2="883.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="448.5" x2="448.5" y1="123.25" y2="883.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="587.5" x2="587.5" y1="123.25" y2="883.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="723.5" x2="723.5" y1="452.2266" y2="883.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="870.5" x2="870.5" y1="123.25" y2="883.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="996.5" x2="996.5" y1="123.25" y2="883.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1126.5" x2="1126.5" y1="123.25" y2="883.8672"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="20" y="119.9482">Application</text><ellipse cx="63" cy="49.9531" fill="#FEFECE" filter="url(#f1453dndg8t41j)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M63,57.9531 L63,84.9531 M50,65.9531 L76,65.9531 M63,84.9531 L50,99.9531 M63,84.9531 L76,99.9531 " fill="none" filter="url(#f1453dndg8t41j)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1453dndg8t41j)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="175.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="182.5" y="107.9482">UniconfigNodeManager</text><rect fill="#FEFECE" filter="url(#f1453dndg8t41j)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="152" x="370.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="138" x="377.5" y="107.9482">MountpointRegistry</text><rect fill="#FEFECE" filter="url(#f1453dndg8t41j)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="540.5" y="83.9531"/><rect fill="#FEFECE" filter="url(#f1453dndg8t41j)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="536.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="543.5" y="107.9482">Mountpoint</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="809.5" y="119.9482">ConfigDatastore</text><path d="M852.5,70.9531 C852.5,60.9531 870.5,60.9531 870.5,60.9531 C870.5,60.9531 888.5,60.9531 888.5,70.9531 L888.5,96.9531 C888.5,106.9531 870.5,106.9531 870.5,106.9531 C870.5,106.9531 852.5,106.9531 852.5,96.9531 L852.5,70.9531 " fill="#FEFECE" filter="url(#f1453dndg8t41j)" style="stroke:#000000;stroke-width:1.5;"/><path d="M852.5,70.9531 C852.5,80.9531 870.5,80.9531 870.5,80.9531 C870.5,80.9531 888.5,80.9531 888.5,70.9531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="941.5" y="119.9482">OperDatastore</text><path d="M979,70.9531 C979,60.9531 997,60.9531 997,60.9531 C997,60.9531 1015,60.9531 1015,70.9531 L1015,96.9531 C1015,106.9531 997,106.9531 997,106.9531 C997,106.9531 979,106.9531 979,96.9531 L979,70.9531 " fill="#FEFECE" filter="url(#f1453dndg8t41j)" style="stroke:#000000;stroke-width:1.5;"/><path d="M979,70.9531 C979,80.9531 997,80.9531 997,80.9531 C997,80.9531 1015,80.9531 1015,70.9531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1453dndg8t41j)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="1066.5" y="83.9531"/><rect fill="#FEFECE" filter="url(#f1453dndg8t41j)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="1062.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1069.5" y="107.9482">NetworkDevice</text><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="741.6172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="263" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="741.6172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="443.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="741.6172" style="stroke:#A80036;stroke-width:1.0;" width="10" x="582.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="424.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="719" y="450.7109"/><polygon fill="#A80036" points="251,150.3828,261,154.3828,251,158.3828,255,154.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="257" y1="154.3828" y2="154.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="70" y="149.3169">commit RPC (target nodes)</text><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="1018" x="172.5" y="162.3828"/><path d="M172.5,162.3828 L238.5,162.3828 L238.5,169.3828 L228.5,179.3828 L172.5,179.3828 L172.5,162.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="176.4497">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="630.5" y="195.4497">previous phases</text><path d="M155.5,214.6484 L231.5,214.6484 L231.5,221.6484 L221.5,231.6484 L155.5,231.6484 L155.5,214.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="427.0234" style="stroke:#000000;stroke-width:2.0;" width="1056" x="155.5" y="214.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="170.5" y="227.7153">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="246.5" y="226.8589">[for each target node]</text><polygon fill="#A80036" points="985,248.9141,995,252.9141,985,256.9141,989,252.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="991" y1="252.9141" y2="252.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="280" y="247.8481">read actual configuration</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="282.0469" y2="278.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="282.0469" y2="286.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="996" y1="282.0469" y2="282.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="290" y="276.981">actual configuration</text><polygon fill="#A80036" points="858.5,307.1797,868.5,311.1797,858.5,315.1797,862.5,311.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="864.5" y1="311.1797" y2="311.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="280" y="306.1138">read intended configuration</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="340.3125" y2="336.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="340.3125" y2="344.3125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="869.5" y1="340.3125" y2="340.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="147" x="290" y="335.2466">intended configuration</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="315" y1="369.4453" y2="369.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315" x2="315" y1="369.4453" y2="382.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="274" x2="315" y1="382.4453" y2="382.4453"/><polygon fill="#A80036" points="284,378.4453,274,382.4453,284,386.4453,280,382.4453" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="280" y="364.3794">calculate diff</text><polygon fill="#A80036" points="570.5,407.5781,580.5,411.5781,570.5,415.5781,574.5,411.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="576.5" y1="411.5781" y2="411.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="280" y="406.5122">create read-write transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="646.5" x2="636.5" y1="440.7109" y2="436.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="646.5" x2="636.5" y1="440.7109" y2="444.7109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="592.5" x2="647.5" y1="440.7109" y2="440.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="27" x="599.5" y="435.645">new</text><rect fill="#FEFECE" filter="url(#f1453dndg8t41j)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="648.5" y="419.5781"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="655.5" y="439.5732">DeviceTransaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="486.0078" y2="482.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="486.0078" y2="490.0078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="581.5" y1="486.0078" y2="486.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121" x="290" y="480.9419">DeviceTransaction</text><path d="M165.5,501.0078 L241.5,501.0078 L241.5,508.0078 L231.5,518.0078 L165.5,518.0078 L165.5,501.0078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="1036" x="165.5" y="501.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="180.5" y="514.0747">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="110" x="256.5" y="513.2183">[for each change]</text><polygon fill="#A80036" points="707,535.2734,717,539.2734,707,543.2734,711,539.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="713" y1="539.2734" y2="539.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="280" y="534.2075">put/merge/delete (path, data)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1125" x2="1115" y1="568.4063" y2="564.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1125" x2="1115" y1="568.4063" y2="572.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="729" x2="1126" y1="568.4063" y2="568.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="736" y="563.3403">configure</text><line style="stroke:#A80036;stroke-width:1.0;" x1="729" x2="739" y1="597.5391" y2="593.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="729" x2="739" y1="597.5391" y2="601.5391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="729" x2="1126" y1="597.5391" y2="597.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="746" y="592.4731">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="626.6719" y2="622.6719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="626.6719" y2="630.6719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="718" y1="626.6719" y2="626.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="290" y="621.606">ack</text><path d="M10,655.6719 L79,655.6719 L79,662.6719 L69,672.6719 L10,672.6719 L10,655.6719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="136.7969" style="stroke:#000000;stroke-width:2.0;" width="1191.5" x="10" y="655.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="25" y="668.7388">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="323" x="94" y="667.8823">[validation of fingerprints failed on at least 1 node]</text><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="1018" x="172.5" y="672.8047"/><path d="M172.5,672.8047 L238.5,672.8047 L238.5,679.8047 L228.5,689.8047 L172.5,689.8047 L172.5,672.8047 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="686.8716">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="626.5" y="705.8716">Rollback changes</text><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="187" x="172.5" y="718.0703"/><path d="M172.5,718.0703 L238.5,718.0703 L238.5,725.0703 L228.5,735.0703 L172.5,735.0703 L172.5,718.0703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="732.1372">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="211.5" y="751.1372">Close transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="784.4688" y2="780.4688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="784.4688" y2="788.4688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="262" y1="784.4688" y2="784.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="80" y="779.4028">RPC response with error</text><rect fill="#FFFFFF" filter="url(#f1453dndg8t41j)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="1018" x="172.5" y="799.4688"/><path d="M172.5,799.4688 L238.5,799.4688 L238.5,806.4688 L228.5,816.4688 L172.5,816.4688 L172.5,799.4688 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="813.5356">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="644" y="832.5356">next phases</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="865.8672" y2="861.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="865.8672" y2="869.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="262" y1="865.8672" y2="865.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="80" y="860.8013">RPC response</text><!--MD5=[e5d589ce19747361780f8e5b580960f6]
@startuml
hide footbox
title "Configuration phase"

actor Application
participant UniconfigNodeManager
participant MountpointRegistry
collections Mountpoint
participant DeviceTransaction
database ConfigDatastore
database OperDatastore
collections NetworkDevice

activate UniconfigNodeManager
activate MountpointRegistry
activate Mountpoint

Application -> UniconfigNodeManager: commit RPC (target nodes)
ref over UniconfigNodeManager, NetworkDevice: previous phases

loop for each target node
    UniconfigNodeManager -> OperDatastore: read actual configuration
    OperDatastore - ->> UniconfigNodeManager: actual configuration
    UniconfigNodeManager -> ConfigDatastore: read intended configuration
    ConfigDatastore - ->> UniconfigNodeManager: intended configuration
    UniconfigNodeManager -> UniconfigNodeManager: calculate diff

    UniconfigNodeManager -> Mountpoint: create read-write transaction
    Mountpoint - ->> DeviceTransaction**: new
    activate DeviceTransaction
    Mountpoint - ->> UniconfigNodeManager: DeviceTransaction

    loop for each change
        UniconfigNodeManager -> DeviceTransaction: put/merge/delete (path, data)
        DeviceTransaction ->> NetworkDevice: configure
        NetworkDevice - ->> DeviceTransaction: ack
        DeviceTransaction - ->> UniconfigNodeManager: ack
    end
end
opt validation of fingerprints failed on at least 1 node
    ref over UniconfigNodeManager, NetworkDevice: Rollback changes
    ref over UniconfigNodeManager: Close transaction
    UniconfigNodeManager - ->> Application: RPC response with error
end

ref over UniconfigNodeManager, NetworkDevice: next phases
UniconfigNodeManager - ->> Application: RPC response
@enduml

PlantUML version 1.2021.11(Sat Oct 02 15:26:11 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>