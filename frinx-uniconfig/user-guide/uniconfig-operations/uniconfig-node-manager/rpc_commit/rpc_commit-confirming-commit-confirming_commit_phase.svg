<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="717px" preserveAspectRatio="none" style="width:1225px;height:717px;background:#FFFFFF;" version="1.1" viewBox="0 0 1225 717" width="1225px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tuygfudzpsmr" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="232" x="494.75" y="28.708">Confirming commit phase</text><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="588.7891" style="stroke:#A80036;stroke-width:1.0;" width="10" x="254" y="112.25"/><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="588.7891" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583" y="112.25"/><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="543.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="755" y="112.25"/><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="470.2578" style="stroke:#000000;stroke-width:2.0;" width="1055" x="156.5" y="193.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="102.25" y2="710.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="258.5" x2="258.5" y1="102.25" y2="710.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="587.5" x2="587.5" y1="102.25" y2="710.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="759.5" x2="759.5" y1="102.25" y2="710.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="909.5" x2="909.5" y1="102.25" y2="710.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1018.5" x2="1018.5" y1="102.25" y2="710.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1136.5" x2="1136.5" y1="102.25" y2="710.0391"/><rect fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="5" y="66.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="12" y="86.9482">Application</text><rect fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="166.5" y="66.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="173.5" y="86.9482">UniconfigNodeManager</text><rect fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="514.5" y="62.9531"/><rect fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="510.5" y="66.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="517.5" y="86.9482">DeviceTransaction</text><rect fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="165" x="675.5" y="66.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="151" x="682.5" y="86.9482">UniconfigTransaction</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="854.5" y="98.9482">OperDatastore</text><path d="M892,49.9531 C892,39.9531 910,39.9531 910,39.9531 C910,39.9531 928,39.9531 928,49.9531 L928,75.9531 C928,85.9531 910,85.9531 910,85.9531 C910,85.9531 892,85.9531 892,75.9531 L892,49.9531 " fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" style="stroke:#000000;stroke-width:1.5;"/><path d="M892,49.9531 C892,59.9531 910,59.9531 910,59.9531 C910,59.9531 928,59.9531 928,49.9531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="975.5" y="98.9482">PostgreSQL</text><path d="M1001,49.9531 C1001,39.9531 1019,39.9531 1019,39.9531 C1019,39.9531 1037,39.9531 1037,49.9531 L1037,75.9531 C1037,85.9531 1019,85.9531 1019,85.9531 C1019,85.9531 1001,85.9531 1001,75.9531 L1001,49.9531 " fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" style="stroke:#000000;stroke-width:1.5;"/><path d="M1001,49.9531 C1001,59.9531 1019,59.9531 1019,59.9531 C1019,59.9531 1037,59.9531 1037,49.9531 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="1076.5" y="62.9531"/><rect fill="#FEFECE" filter="url(#f1tuygfudzpsmr)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="1072.5" y="66.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="1079.5" y="86.9482">NetworkDevice</text><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="588.7891" style="stroke:#A80036;stroke-width:1.0;" width="10" x="254" y="112.25"/><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="588.7891" style="stroke:#A80036;stroke-width:1.0;" width="10" x="583" y="112.25"/><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="543.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="755" y="112.25"/><polygon fill="#A80036" points="242,129.3828,252,133.3828,242,137.3828,246,133.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="248" y1="133.3828" y2="133.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="61" y="128.3169">commit RPC (target nodes)</text><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="1037" x="163.5" y="141.3828"/><path d="M163.5,141.3828 L229.5,141.3828 L229.5,148.3828 L219.5,158.3828 L163.5,158.3828 L163.5,141.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="176.5" y="155.4497">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="631" y="174.4497">previous phases</text><path d="M156.5,193.6484 L232.5,193.6484 L232.5,200.6484 L222.5,210.6484 L156.5,210.6484 L156.5,193.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="470.2578" style="stroke:#000000;stroke-width:2.0;" width="1055" x="156.5" y="193.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="171.5" y="206.7153">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="247.5" y="205.8589">[for each target node]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="581" x2="571" y1="231.9141" y2="227.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="581" x2="571" y1="231.9141" y2="235.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="582" y1="231.9141" y2="231.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="271" y="226.8481">read (config-metadata node IID)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1135" x2="1125" y1="261.0469" y2="257.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1135" x2="1125" y1="261.0469" y2="265.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="593" x2="1136" y1="261.0469" y2="261.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="600" y="255.981">read metadata</text><line style="stroke:#A80036;stroke-width:1.0;" x1="593" x2="603" y1="290.1797" y2="286.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="593" x2="603" y1="290.1797" y2="294.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="593" x2="1136" y1="290.1797" y2="290.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="63" x="610" y="285.1138">metadata</text><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="319.3125" y2="315.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="319.3125" y2="323.3125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="264" x2="582" y1="319.3125" y2="319.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="295" x="281" y="314.2466">config-metadata (includes device fingerprint)</text><polygon fill="#A80036" points="898,344.4453,908,348.4453,898,352.4453,902,348.4453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="904" y1="348.4453" y2="348.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181" x="271" y="343.3794">write node config-metadata</text><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="377.5781" y2="373.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="377.5781" y2="381.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="264" x2="909" y1="377.5781" y2="377.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="281" y="372.5122">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="581" x2="571" y1="406.7109" y2="402.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="581" x2="571" y1="406.7109" y2="410.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="582" y1="406.7109" y2="406.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="50" x="271" y="401.645">commit</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1135" x2="1125" y1="435.8438" y2="431.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1135" x2="1125" y1="435.8438" y2="439.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="593" x2="1136" y1="435.8438" y2="435.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="157" x="600" y="430.7778">commit RPC / command</text><line style="stroke:#A80036;stroke-width:1.0;" x1="593" x2="603" y1="464.9766" y2="460.9766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="593" x2="603" y1="464.9766" y2="468.9766"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="593" x2="1136" y1="464.9766" y2="464.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="610" y="459.9106">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="494.1094" y2="490.1094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="494.1094" y2="498.1094"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="264" x2="582" y1="494.1094" y2="494.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="281" y="489.0435">ack</text><polygon fill="#A80036" points="743,519.2422,753,523.2422,743,527.2422,747,523.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="749" y1="523.2422" y2="523.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="45" x="271" y="518.1763">submit</text><polygon fill="#A80036" points="1007,548.375,1017,552.375,1007,556.375,1011,552.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="765" x2="1013" y1="552.375" y2="552.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="772" y="547.3091">send updates</text><line style="stroke:#A80036;stroke-width:1.0;" x1="765" x2="775" y1="581.5078" y2="577.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="765" x2="775" y1="581.5078" y2="585.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="765" x2="1018" y1="581.5078" y2="581.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="782" y="576.4419">ack</text><rect fill="#FFFFFF" filter="url(#f1tuygfudzpsmr)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="196" x="672.5" y="589.5078"/><path d="M672.5,589.5078 L738.5,589.5078 L738.5,596.5078 L728.5,606.5078 L672.5,606.5078 L672.5,589.5078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="685.5" y="603.5747">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="678.5" y="622.5747">Clean orphaned mountpoints</text><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="655.9063" y2="651.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="264" x2="274" y1="655.9063" y2="659.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="264" x2="759" y1="655.9063" y2="655.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="281" y="650.8403">ack</text><line style="stroke:#A80036;stroke-width:2.0;" x1="751" x2="769" y1="646.9063" y2="664.9063"/><line style="stroke:#A80036;stroke-width:2.0;" x1="751" x2="769" y1="664.9063" y2="646.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="64" y1="692.0391" y2="688.0391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="64" y1="692.0391" y2="696.0391"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="54" x2="253" y1="692.0391" y2="692.0391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="71" y="686.9731">RPC response</text><!--MD5=[2d0bd3b0d589f1da51562ee38bbeb327]
@startuml
hide footbox
title "Confirming commit phase"

participant Application
participant UniconfigNodeManager
collections DeviceTransaction
participant UniconfigTransaction
database OperDatastore
database PostgreSQL
collections NetworkDevice

activate UniconfigNodeManager
activate DeviceTransaction
activate UniconfigTransaction

Application -> UniconfigNodeManager: commit RPC (target nodes)
ref over UniconfigNodeManager, NetworkDevice: previous phases

loop for each target node
    UniconfigNodeManager ->> DeviceTransaction: read (config-metadata node IID)
    DeviceTransaction ->> NetworkDevice: read metadata
    NetworkDevice - ->> DeviceTransaction: metadata
    DeviceTransaction - ->> UniconfigNodeManager: config-metadata (includes device fingerprint)
    UniconfigNodeManager -> OperDatastore: write node config-metadata
    OperDatastore - ->> UniconfigNodeManager: ack

    UniconfigNodeManager ->> DeviceTransaction: commit
    DeviceTransaction ->> NetworkDevice: commit RPC / command
    NetworkDevice - ->> DeviceTransaction: ack
    DeviceTransaction - ->> UniconfigNodeManager: ack

    UniconfigNodeManager -> UniconfigTransaction: submit
    UniconfigTransaction -> PostgreSQL: send updates
    PostgreSQL - ->> UniconfigTransaction: ack
    ref over UniconfigTransaction: Clean orphaned mountpoints
    UniconfigTransaction - ->> UniconfigNodeManager: ack
    destroy UniconfigTransaction
end

UniconfigNodeManager - ->> Application: RPC response
@enduml

PlantUML version 1.2021.11(Sat Oct 02 15:26:11 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>