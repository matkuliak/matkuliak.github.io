<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="578px" preserveAspectRatio="none" style="width:914px;height:578px;background:#FFFFFF;" version="1.1" viewBox="0 0 914 578" width="914px" zoomAndPan="magnify"><defs><filter height="300%" id="fb56s0cu4oizn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="156" x="377" y="28.708">Rollback changes</text><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="473.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="127.5" y="89.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="74.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="307.5" y="89.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="473.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="444" y="89.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="241.2266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="620" y="298.1797"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="473.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="800.5" y="89.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="458.1563" style="stroke:#000000;stroke-width:2.0;" width="890" x="10" y="96.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="368.7578" style="stroke:#000000;stroke-width:2.0;" width="870" x="20" y="178.6484"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="850" x="30" y="348.4766"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="132" x2="132" y1="79.25" y2="571.4063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="312" x2="312" y1="79.25" y2="571.4063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="449" x2="449" y1="79.25" y2="571.4063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="625" x2="625" y1="299.6953" y2="571.4063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="805" x2="805" y1="79.25" y2="571.4063"/><rect fill="#FEFECE" filter="url(#fb56s0cu4oizn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="40" y="43.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="47" y="63.9482">UniconfigNodeManager</text><rect fill="#FEFECE" filter="url(#fb56s0cu4oizn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="239" y="39.9531"/><rect fill="#FEFECE" filter="url(#fb56s0cu4oizn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="235" y="43.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="242" y="63.9482">DeviceTransaction</text><rect fill="#FEFECE" filter="url(#fb56s0cu4oizn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="400" y="43.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="407" y="63.9482">Mountpoint</text><rect fill="#FEFECE" filter="url(#fb56s0cu4oizn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="745" y="39.9531"/><rect fill="#FEFECE" filter="url(#fb56s0cu4oizn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="741" y="43.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="748" y="63.9482">NetworkDevice</text><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="473.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="127.5" y="89.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="74.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="307.5" y="89.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="473.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="444" y="89.25"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="241.2266" style="stroke:#A80036;stroke-width:1.0;" width="10" x="620" y="298.1797"/><rect fill="#FFFFFF" filter="url(#fb56s0cu4oizn)" height="473.1563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="800.5" y="89.25"/><path d="M10,96.25 L86,96.25 L86,103.25 L76,113.25 L10,113.25 L10,96.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="458.1563" style="stroke:#000000;stroke-width:2.0;" width="890" x="10" y="96.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="25" y="109.3169">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="96" x="101" y="108.4604">[for each node]</text><polygon fill="#A80036" points="295.5,130.5156,305.5,134.5156,295.5,138.5156,299.5,134.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="301.5" y1="134.5156" y2="134.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="144.5" y="129.4497">close transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="163.6484" y2="159.6484"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="163.6484" y2="167.6484"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="137.5" x2="311.5" y1="163.6484" y2="163.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="154.5" y="158.5825">ack</text><line style="stroke:#A80036;stroke-width:2.0;" x1="303.5" x2="321.5" y1="154.6484" y2="172.6484"/><line style="stroke:#A80036;stroke-width:2.0;" x1="303.5" x2="321.5" y1="172.6484" y2="154.6484"/><path d="M20,178.6484 L89,178.6484 L89,185.6484 L79,195.6484 L20,195.6484 L20,178.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="368.7578" style="stroke:#000000;stroke-width:2.0;" width="870" x="20" y="178.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="35" y="191.7153">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="124" x="104" y="190.8589">[rollback is needed]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="179.5" y1="216.9141" y2="216.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="179.5" x2="179.5" y1="216.9141" y2="229.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138.5" x2="179.5" y1="229.9141" y2="229.9141"/><polygon fill="#A80036" points="148.5,225.9141,138.5,229.9141,148.5,233.9141,144.5,229.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="144.5" y="211.8481">get inverted diff</text><polygon fill="#A80036" points="432,255.0469,442,259.0469,432,263.0469,436,259.0469" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="438" y1="259.0469" y2="259.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="144.5" y="253.981">create transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="507" y1="288.1797" y2="284.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="517" x2="507" y1="288.1797" y2="292.1797"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="454" x2="518" y1="288.1797" y2="288.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="41" x="461" y="283.1138">create</text><rect fill="#FEFECE" filter="url(#fb56s0cu4oizn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="208" x="519" y="267.0469"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194" x="526" y="287.042">RollbackDeviceTransaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="333.4766" y2="329.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="333.4766" y2="337.4766"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="137.5" x2="443" y1="333.4766" y2="333.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="154.5" y="328.4106">RollbackDeviceTransaction</text><path d="M30,348.4766 L106,348.4766 L106,355.4766 L96,365.4766 L30,365.4766 L30,348.4766 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="850" x="30" y="348.4766"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="45" y="361.5435">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="165" x="121" y="360.687">[for each inverted change]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="618" x2="608" y1="386.7422" y2="382.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="618" x2="608" y1="386.7422" y2="390.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="619" y1="386.7422" y2="386.7422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="144.5" y="381.6763">put/merge/delete (path, data)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="788.5" y1="415.875" y2="411.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="798.5" x2="788.5" y1="415.875" y2="419.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="630" x2="799.5" y1="415.875" y2="415.875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="637" y="410.8091">configure</text><line style="stroke:#A80036;stroke-width:1.0;" x1="630" x2="640" y1="445.0078" y2="441.0078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="630" x2="640" y1="445.0078" y2="449.0078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="630" x2="799.5" y1="445.0078" y2="445.0078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="647" y="439.9419">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="474.1406" y2="470.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="474.1406" y2="478.1406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="137.5" x2="619" y1="474.1406" y2="474.1406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="154.5" y="469.0747">ack</text><polygon fill="#A80036" points="608,506.2734,618,510.2734,608,514.2734,612,510.2734" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="614" y1="510.2734" y2="510.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="34" x="144.5" y="505.2075">close</text><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="539.4063" y2="535.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.5" x2="147.5" y1="539.4063" y2="543.4063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="137.5" x2="624" y1="539.4063" y2="539.4063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="154.5" y="534.3403">ack</text><line style="stroke:#A80036;stroke-width:2.0;" x1="616" x2="634" y1="530.4063" y2="548.4063"/><line style="stroke:#A80036;stroke-width:2.0;" x1="616" x2="634" y1="548.4063" y2="530.4063"/><!--MD5=[ddf56470710b45efff51fef6982dfdb1]
@startuml
hide footbox
title "Rollback changes"

participant UniconfigNodeManager
collections DeviceTransaction
participant Mountpoint
participant RollbackDeviceTransaction
collections NetworkDevice

activate UniconfigNodeManager
activate DeviceTransaction
activate Mountpoint
activate NetworkDevice

loop for each node
    UniconfigNodeManager -> DeviceTransaction: close transaction
    DeviceTransaction - ->> UniconfigNodeManager: ack
    destroy DeviceTransaction

    opt rollback is needed
        UniconfigNodeManager -> UniconfigNodeManager: get inverted diff
        UniconfigNodeManager -> Mountpoint: create transaction
        Mountpoint - ->> RollbackDeviceTransaction**: create
        activate RollbackDeviceTransaction
        Mountpoint - ->> UniconfigNodeManager: RollbackDeviceTransaction
        loop for each inverted change
            UniconfigNodeManager ->> RollbackDeviceTransaction: put/merge/delete (path, data)
            RollbackDeviceTransaction ->> NetworkDevice: configure
            NetworkDevice - ->> RollbackDeviceTransaction: ack
            RollbackDeviceTransaction - ->> UniconfigNodeManager: ack
        end
        UniconfigNodeManager -> RollbackDeviceTransaction: close
        RollbackDeviceTransaction - ->> UniconfigNodeManager: ack
        destroy RollbackDeviceTransaction
    end
end
@enduml

PlantUML version 1.2021.11(Sat Oct 02 15:26:11 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>