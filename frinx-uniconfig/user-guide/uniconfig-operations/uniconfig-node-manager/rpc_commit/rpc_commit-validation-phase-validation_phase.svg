<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="686px" preserveAspectRatio="none" style="width:1016px;height:686px;background:#FFFFFF;" version="1.1" viewBox="0 0 1016 686" width="1016px" zoomAndPan="magnify"><defs><filter height="300%" id="f1fg2tcuo0a52s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="148" x="432" y="28.708">Validation phase</text><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="537.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="263" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="537.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="585" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="537.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="723.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="223.0625" style="stroke:#000000;stroke-width:2.0;" width="846.5" x="155.5" y="214.6484"/><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="826.5" x="165.5" y="297.0469"/><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="136.7969" style="stroke:#000000;stroke-width:2.0;" width="982" x="10" y="451.7109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="123.25" y2="679.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="267.5" x2="267.5" y1="123.25" y2="679.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="590" x2="590" y1="123.25" y2="679.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="728" x2="728" y1="123.25" y2="679.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="917" x2="917" y1="123.25" y2="679.9063"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="20" y="119.9482">Application</text><ellipse cx="63" cy="49.9531" fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M63,57.9531 L63,84.9531 M50,65.9531 L76,65.9531 M63,84.9531 L50,99.9531 M63,84.9531 L76,99.9531 " fill="none" filter="url(#f1fg2tcuo0a52s)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="175.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="182.5" y="107.9482">UniconfigNodeManager</text><rect fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="543" y="83.9531"/><rect fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="539" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="546" y="107.9482">Mountpoint</text><rect fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="655" y="83.9531"/><rect fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="651" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="658" y="107.9482">DeviceTransaction</text><rect fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="857" y="83.9531"/><rect fill="#FEFECE" filter="url(#f1fg2tcuo0a52s)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="853" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="860" y="107.9482">NetworkDevice</text><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="537.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="263" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="537.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="585" y="133.25"/><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="537.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="723.5" y="133.25"/><polygon fill="#A80036" points="251,150.3828,261,154.3828,251,158.3828,255,154.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="257" y1="154.3828" y2="154.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="70" y="149.3169">RPC commit (target nodes)</text><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="808.5" x="172.5" y="162.3828"/><path d="M172.5,162.3828 L238.5,162.3828 L238.5,169.3828 L228.5,179.3828 L172.5,179.3828 L172.5,162.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="176.4497">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="525.75" y="195.4497">previous phases</text><path d="M155.5,214.6484 L231.5,214.6484 L231.5,221.6484 L221.5,231.6484 L155.5,231.6484 L155.5,214.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="223.0625" style="stroke:#000000;stroke-width:2.0;" width="846.5" x="155.5" y="214.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="170.5" y="227.7153">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="246.5" y="226.8589">[for each target node]</text><polygon fill="#A80036" points="573,248.9141,583,252.9141,573,256.9141,577,252.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="579" y1="252.9141" y2="252.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="280" y="247.8481">check if validation is supported and enabled</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="282.0469" y2="278.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="282.0469" y2="286.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="584" y1="282.0469" y2="282.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="233" x="290" y="276.981">is validation supported and enabled</text><path d="M165.5,297.0469 L234.5,297.0469 L234.5,304.0469 L224.5,314.0469 L165.5,314.0469 L165.5,297.0469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="826.5" x="165.5" y="297.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="180.5" y="310.1138">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="235" x="249.5" y="309.2573">[validation is supported and enabled]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="721.5" x2="711.5" y1="335.3125" y2="331.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="721.5" x2="711.5" y1="335.3125" y2="339.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="722.5" y1="335.3125" y2="335.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="280" y="330.2466">validate configuration</text><line style="stroke:#A80036;stroke-width:1.0;" x1="915.5" x2="905.5" y1="364.4453" y2="360.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="915.5" x2="905.5" y1="364.4453" y2="368.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="733.5" x2="916.5" y1="364.4453" y2="364.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="740.5" y="359.3794">validate RPC / command</text><line style="stroke:#A80036;stroke-width:1.0;" x1="733.5" x2="743.5" y1="393.5781" y2="389.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="733.5" x2="743.5" y1="393.5781" y2="397.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="733.5" x2="916.5" y1="393.5781" y2="393.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="750.5" y="388.5122">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="422.7109" y2="418.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="422.7109" y2="426.7109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="722.5" y1="422.7109" y2="422.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="290" y="417.645">future</text><path d="M10,451.7109 L79,451.7109 L79,458.7109 L69,468.7109 L10,468.7109 L10,451.7109 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="136.7969" style="stroke:#000000;stroke-width:2.0;" width="982" x="10" y="451.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="25" y="464.7778">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="228" x="94" y="463.9214">[validation failed on at least 1 node]</text><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="808.5" x="172.5" y="468.8438"/><path d="M172.5,468.8438 L238.5,468.8438 L238.5,475.8438 L228.5,485.8438 L172.5,485.8438 L172.5,468.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="482.9106">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="521.75" y="501.9106">Rollback changes</text><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="187" x="172.5" y="514.1094"/><path d="M172.5,514.1094 L238.5,514.1094 L238.5,521.1094 L228.5,531.1094 L172.5,531.1094 L172.5,514.1094 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="528.1763">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="211.5" y="547.1763">Close transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="580.5078" y2="576.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="580.5078" y2="584.5078"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="262" y1="580.5078" y2="580.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="80" y="575.4419">response with error</text><rect fill="#FFFFFF" filter="url(#f1fg2tcuo0a52s)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="808.5" x="172.5" y="595.5078"/><path d="M172.5,595.5078 L238.5,595.5078 L238.5,602.5078 L228.5,612.5078 L172.5,612.5078 L172.5,595.5078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="609.5747">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="539.25" y="628.5747">next phases</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="661.9063" y2="657.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="661.9063" y2="665.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="262" y1="661.9063" y2="661.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="80" y="656.8403">RPC response</text><!--MD5=[10f6ef42a33ce40713354ce1e3ebe2af]
@startuml
hide footbox
title "Validation phase"

actor Application
participant UniconfigNodeManager
collections Mountpoint
collections DeviceTransaction
collections NetworkDevice

activate UniconfigNodeManager
activate Mountpoint
activate DeviceTransaction

Application -> UniconfigNodeManager: RPC commit (target nodes)
ref over UniconfigNodeManager, NetworkDevice: previous phases

loop for each target node
    UniconfigNodeManager -> Mountpoint: check if validation is supported and enabled
    UniconfigNodeManager <<- - Mountpoint: is validation supported and enabled
    opt validation is supported and enabled
        UniconfigNodeManager ->> DeviceTransaction: validate configuration
        DeviceTransaction ->> NetworkDevice: validate RPC / command
        NetworkDevice - ->> DeviceTransaction: ack
        UniconfigNodeManager <<- - DeviceTransaction: future
    end
end
opt validation failed on at least 1 node
    ref over UniconfigNodeManager, NetworkDevice: Rollback changes
    ref over UniconfigNodeManager: Close transaction
    UniconfigNodeManager - ->> Application: response with error
end

ref over UniconfigNodeManager, NetworkDevice: next phases
UniconfigNodeManager - ->> Application: RPC response
@enduml

PlantUML version 1.2021.11(Sat Oct 02 15:26:11 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>