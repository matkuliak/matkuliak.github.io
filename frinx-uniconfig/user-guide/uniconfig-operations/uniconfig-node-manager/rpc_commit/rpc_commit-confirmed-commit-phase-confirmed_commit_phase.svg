<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="923px" preserveAspectRatio="none" style="width:1148px;height:923px;background:#FFFFFF;" version="1.1" viewBox="0 0 1148 923" width="1148px" zoomAndPan="magnify"><defs><filter height="300%" id="fiftt5z7nozmn" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="227" x="458.5" y="28.708">Confirmed commit phase</text><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="774.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="263" y="133.25"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="774.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="640" y="133.25"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="774.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="778.5" y="133.25"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="223.0625" style="stroke:#000000;stroke-width:2.0;" width="968.5" x="155.5" y="214.6484"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="948.5" x="165.5" y="297.0469"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="373.8594" style="stroke:#000000;stroke-width:2.0;" width="1124" x="10" y="451.7109"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="223.0625" style="stroke:#000000;stroke-width:2.0;" width="968.5" x="155.5" y="475.8438"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="948.5" x="165.5" y="558.2422"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="63" x2="63" y1="123.25" y2="916.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="267.5" x2="267.5" y1="123.25" y2="916.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="645" x2="645" y1="123.25" y2="916.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="783" x2="783" y1="123.25" y2="916.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1039" x2="1039" y1="123.25" y2="916.9688"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="20" y="119.9482">Application</text><ellipse cx="63" cy="49.9531" fill="#FEFECE" filter="url(#fiftt5z7nozmn)" rx="8" ry="8" style="stroke:#A80036;stroke-width:2.0;"/><path d="M63,57.9531 L63,84.9531 M50,65.9531 L76,65.9531 M63,84.9531 L50,99.9531 M63,84.9531 L76,99.9531 " fill="none" filter="url(#fiftt5z7nozmn)" style="stroke:#A80036;stroke-width:2.0;"/><rect fill="#FEFECE" filter="url(#fiftt5z7nozmn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="181" x="175.5" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167" x="182.5" y="107.9482">UniconfigNodeManager</text><rect fill="#FEFECE" filter="url(#fiftt5z7nozmn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="598" y="83.9531"/><rect fill="#FEFECE" filter="url(#fiftt5z7nozmn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="94" x="594" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="601" y="107.9482">Mountpoint</text><rect fill="#FEFECE" filter="url(#fiftt5z7nozmn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="710" y="83.9531"/><rect fill="#FEFECE" filter="url(#fiftt5z7nozmn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="147" x="706" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="133" x="713" y="107.9482">DeviceTransaction</text><rect fill="#FEFECE" filter="url(#fiftt5z7nozmn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="979" y="83.9531"/><rect fill="#FEFECE" filter="url(#fiftt5z7nozmn)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="121" x="975" y="87.9531"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="982" y="107.9482">NetworkDevice</text><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="774.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="263" y="133.25"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="774.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="640" y="133.25"/><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="774.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="778.5" y="133.25"/><polygon fill="#A80036" points="251,150.3828,261,154.3828,251,158.3828,255,154.3828" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="257" y1="154.3828" y2="154.3828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="70" y="149.3169">RPC commit (target nodes)</text><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="930.5" x="172.5" y="162.3828"/><path d="M172.5,162.3828 L238.5,162.3828 L238.5,169.3828 L228.5,179.3828 L172.5,179.3828 L172.5,162.3828 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="176.4497">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="586.75" y="195.4497">previous phases</text><path d="M155.5,214.6484 L231.5,214.6484 L231.5,221.6484 L221.5,231.6484 L155.5,231.6484 L155.5,214.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="223.0625" style="stroke:#000000;stroke-width:2.0;" width="968.5" x="155.5" y="214.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="170.5" y="227.7153">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="246.5" y="226.8589">[for each target node]</text><polygon fill="#A80036" points="628,248.9141,638,252.9141,628,256.9141,632,252.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="634" y1="252.9141" y2="252.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="343" x="280" y="247.8481">check if confirmed commit is supported and enabled</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="282.0469" y2="278.0469"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="282.0469" y2="286.0469"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="639" y1="282.0469" y2="282.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="288" x="290" y="276.981">is confirmed commit supported and enabled</text><path d="M165.5,297.0469 L234.5,297.0469 L234.5,304.0469 L224.5,314.0469 L165.5,314.0469 L165.5,297.0469 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="948.5" x="165.5" y="297.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="180.5" y="310.1138">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="206" x="249.5" y="309.2573">[confirmed commit is supported]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="776.5" x2="766.5" y1="335.3125" y2="331.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="776.5" x2="766.5" y1="335.3125" y2="339.3125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="777.5" y1="335.3125" y2="335.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="280" y="330.2466">confirmed commit</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1037.5" x2="1027.5" y1="364.4453" y2="360.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1037.5" x2="1027.5" y1="364.4453" y2="368.4453"/><line style="stroke:#A80036;stroke-width:1.0;" x1="788.5" x2="1038.5" y1="364.4453" y2="364.4453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="227" x="795.5" y="359.3794">confirmed commit RPC / command</text><line style="stroke:#A80036;stroke-width:1.0;" x1="788.5" x2="798.5" y1="393.5781" y2="389.5781"/><line style="stroke:#A80036;stroke-width:1.0;" x1="788.5" x2="798.5" y1="393.5781" y2="397.5781"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788.5" x2="1038.5" y1="393.5781" y2="393.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="805.5" y="388.5122">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="422.7109" y2="418.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="422.7109" y2="426.7109"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="777.5" y1="422.7109" y2="422.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="290" y="417.645">future</text><path d="M10,451.7109 L79,451.7109 L79,458.7109 L69,468.7109 L10,468.7109 L10,451.7109 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="373.8594" style="stroke:#000000;stroke-width:2.0;" width="1124" x="10" y="451.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="25" y="464.7778">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="279" x="94" y="463.9214">[confirmed commit failed on at least 1 node]</text><path d="M155.5,475.8438 L231.5,475.8438 L231.5,482.8438 L221.5,492.8438 L155.5,492.8438 L155.5,475.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="223.0625" style="stroke:#000000;stroke-width:2.0;" width="968.5" x="155.5" y="475.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="31" x="170.5" y="488.9106">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="137" x="246.5" y="488.0542">[for each target node]</text><polygon fill="#A80036" points="628,510.1094,638,514.1094,628,518.1094,632,514.1094" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="634" y1="514.1094" y2="514.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235" x="280" y="509.0435">check if cancel commit is supported</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="543.2422" y2="539.2422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="543.2422" y2="547.2422"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="639" y1="543.2422" y2="543.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="290" y="538.1763">is cancel commit supported</text><path d="M165.5,558.2422 L234.5,558.2422 L234.5,565.2422 L224.5,575.2422 L165.5,575.2422 L165.5,558.2422 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="948.5" x="165.5" y="558.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="24" x="180.5" y="571.3091">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="183" x="249.5" y="570.4526">[cancel commit is supported]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="776.5" x2="766.5" y1="596.5078" y2="592.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="776.5" x2="766.5" y1="596.5078" y2="600.5078"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="777.5" y1="596.5078" y2="596.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="280" y="591.4419">cancel commit</text><line style="stroke:#A80036;stroke-width:1.0;" x1="1037.5" x2="1027.5" y1="625.6406" y2="621.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="1037.5" x2="1027.5" y1="625.6406" y2="629.6406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="788.5" x2="1038.5" y1="625.6406" y2="625.6406"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="126" x="795.5" y="620.5747">cancel commit RPC</text><line style="stroke:#A80036;stroke-width:1.0;" x1="788.5" x2="798.5" y1="654.7734" y2="650.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="788.5" x2="798.5" y1="654.7734" y2="658.7734"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="788.5" x2="1038.5" y1="654.7734" y2="654.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="805.5" y="649.7075">ack</text><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="683.9063" y2="679.9063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="273" x2="283" y1="683.9063" y2="687.9063"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="273" x2="777.5" y1="683.9063" y2="683.9063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="39" x="290" y="678.8403">future</text><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="930.5" x="172.5" y="705.9063"/><path d="M172.5,705.9063 L238.5,705.9063 L238.5,712.9063 L228.5,722.9063 L172.5,722.9063 L172.5,705.9063 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="719.9731">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="582.75" y="738.9731">Rollback changes</text><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="187" x="172.5" y="751.1719"/><path d="M172.5,751.1719 L238.5,751.1719 L238.5,758.1719 L228.5,768.1719 L172.5,768.1719 L172.5,751.1719 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="765.2388">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="211.5" y="784.2388">Close transaction</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="817.5703" y2="813.5703"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="817.5703" y2="821.5703"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="262" y1="817.5703" y2="817.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="80" y="812.5044">RPC response with error</text><rect fill="#FFFFFF" filter="url(#fiftt5z7nozmn)" height="40.2656" style="stroke:#000000;stroke-width:2.0;" width="930.5" x="172.5" y="832.5703"/><path d="M172.5,832.5703 L238.5,832.5703 L238.5,839.5703 L228.5,849.5703 L172.5,849.5703 L172.5,832.5703 " fill="#EEEEEE" style="stroke:#000000;stroke-width:2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="185.5" y="846.6372">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="600.25" y="865.6372">next phases</text><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="898.9688" y2="894.9688"/><line style="stroke:#A80036;stroke-width:1.0;" x1="63" x2="73" y1="898.9688" y2="902.9688"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="63" x2="262" y1="898.9688" y2="898.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89" x="80" y="893.9028">RPC response</text><!--MD5=[aaf2f41816d9397dba9cef36492dcd64]
@startuml
hide footbox
title "Confirmed commit phase"

actor Application
participant UniconfigNodeManager
collections Mountpoint
collections DeviceTransaction
collections NetworkDevice

activate UniconfigNodeManager
activate Mountpoint
activate DeviceTransaction

Application -> UniconfigNodeManager: RPC commit (target nodes)
ref over UniconfigNodeManager, NetworkDevice: previous phases

loop for each target node
    UniconfigNodeManager -> Mountpoint: check if confirmed commit is supported and enabled
    UniconfigNodeManager <<- - Mountpoint: is confirmed commit supported and enabled
    opt confirmed commit is supported
        UniconfigNodeManager ->> DeviceTransaction: confirmed commit
        DeviceTransaction ->> NetworkDevice: confirmed commit RPC / command
        DeviceTransaction <<- - NetworkDevice: ack
        UniconfigNodeManager <<- - DeviceTransaction: future
    end
end

opt confirmed commit failed on at least 1 node
    loop for each target node
        UniconfigNodeManager -> Mountpoint: check if cancel commit is supported
        UniconfigNodeManager <<- - Mountpoint: is cancel commit supported
        opt cancel commit is supported
            UniconfigNodeManager ->> DeviceTransaction: cancel commit
            DeviceTransaction ->> NetworkDevice: cancel commit RPC
            DeviceTransaction <<- - NetworkDevice: ack
            UniconfigNodeManager <<- - DeviceTransaction: future
        end
    end
    ref over UniconfigNodeManager, NetworkDevice: Rollback changes
    ref over UniconfigNodeManager: Close transaction
    Application <<- - UniconfigNodeManager: RPC response with error
end

ref over UniconfigNodeManager, NetworkDevice: next phases
Application <<- - UniconfigNodeManager: RPC response
@enduml

PlantUML version 1.2021.11(Sat Oct 02 15:26:11 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>